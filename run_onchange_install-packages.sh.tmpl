{{ if and (eq .chezmoi.os "linux") (eq .chezmoi.osRelease.id "arch") -}}
#!/bin/sh
############ Arch ############
sudo pacman -S --noconfirm ripgrep zsh lazygit nodejs

# Install yay if not already installed (for AUR packages)
if ! command -v yay &> /dev/null; then
  git clone https://aur.archlinux.org/yay.git /tmp/yay
  cd /tmp/yay
  makepkg -si --noconfirm
  cd -
  rm -rf /tmp/yay
fi

# Install AUR packages
yay -S --noconfirm zed obsidian ghostty

# Install GitHub Copilot CLI
if ! command -v copilot &> /dev/null; then
  npm install -g @github/copilot
fi

# Install oh-my-zsh if not already installed
if [ ! -d "$HOME/.oh-my-zsh" ]; then
  sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended
fi

# Install zsh-autosuggestions
if [ ! -d "${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/plugins/zsh-autosuggestions" ]; then
  git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
fi

# Install zsh-syntax-highlighting
if [ ! -d "${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting" ]; then
  git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting
fi

{{ else if eq .chezmoi.os "darwin" -}}
#!/bin/sh
############ macOS ############
brew install ripgrep zsh lazygit node

# Install cask applications
brew install --cask zed obsidian ghostty

# macOS-only applications
brew install --cask maccy

# evkey (check if available via homebrew or install manually)
if brew info evkey &> /dev/null; then
  brew install --cask evkey
else
  echo "evkey not available via Homebrew. Please install manually from https://evkeyvn.com/"
fi

# Install GitHub Copilot CLI
if ! command -v copilot &> /dev/null; then
  brew install copilot-cli
fi

# Install oh-my-zsh if not already installed
if [ ! -d "$HOME/.oh-my-zsh" ]; then
  sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended
fi

# Install zsh-autosuggestions
if [ ! -d "${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/plugins/zsh-autosuggestions" ]; then
  git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
fi

# Install zsh-syntax-highlighting
if [ ! -d "${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting" ]; then
  git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting
fi


{{ else if eq .chezmoi.os "linux" -}}
#!/bin/sh
############ Debian ############
sudo apt update
sudo apt install -y ripgrep curl

# Install Node.js (using NodeSource repository for latest LTS)
if ! command -v node &> /dev/null; then
  curl -fsSL https://deb.nodesource.com/setup_lts.x | sudo -E bash -
  sudo apt install -y nodejs
fi

# Install lazygit
LAZYGIT_VERSION=$(curl -s "https://api.github.com/repos/jesseduffield/lazygit/releases/latest" | grep -Po '"tag_name": "v\K[^"]*')
curl -Lo lazygit.tar.gz "https://github.com/jesseduffield/lazygit/releases/latest/download/lazygit_${LAZYGIT_VERSION}_Linux_x86_64.tar.gz"
tar xf lazygit.tar.gz lazygit
sudo install lazygit /usr/local/bin
rm lazygit lazygit.tar.gz

# Install Zed
curl -f https://zed.dev/install.sh | sh

# Install Obsidian
if ! command -v obsidian &> /dev/null; then
  OBSIDIAN_VERSION=$(curl -s "https://api.github.com/repos/obsidianmd/obsidian-releases/releases/latest" | grep -Po '"tag_name": "v\K[^"]*')
  curl -Lo obsidian.AppImage "https://github.com/obsidianmd/obsidian-releases/releases/latest/download/Obsidian-${OBSIDIAN_VERSION}.AppImage"
  chmod +x obsidian.AppImage
  sudo mv obsidian.AppImage /usr/local/bin/obsidian
fi

# Install Ghostty (if available via package manager or build from source)
echo "Ghostty installation may require manual setup. Check https://github.com/ghostty-org/ghostty"

# Install GitHub Copilot CLI
if ! command -v copilot &> /dev/null; then
  npm install -g @github/copilot
fi
{{ end -}}
